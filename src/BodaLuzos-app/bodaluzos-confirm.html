<link rel="import" href="../../bower_components/paper-card/paper-card.html">
<link rel="import" href="../../bower_components/paper-button/paper-button.html">
<link rel="import" href="../../bower_components/paper-input/paper-input.html">

<link rel="import" href="../../bower_components/polymerfire/firebase-app.html">
<link rel="import" href="../../bower_components/polymerfire/firebase-auth.html">
<link rel="import" href="../../bower_components/polymerfire/firebase-document.html">

<link rel="import" href="../../bower_components/gold-email-input/gold-email-input.html">
<link rel="import" href="../../bower_components/gold-phone-input/gold-phone-input.html">
<dom-module id="bodaluzos-confirm">
    <template>
        <style>
            :host {
                display: block;
                margin: 10px auto;
                width: 70%;
                --paper-card-actions: {
                    display: flex;
                    justify-content: center;
                }
            }
            
            .header {
                @apply(--paper-font-headline);
                color: var(--app-dark-gray-color);
            }
            
            .header-icon {
                float: right;
                font-size: 15px;
                vertical-align: middle;
            }
            
            a {
                text-decoration: none;
            }
            
            paper-button {
                margin: 10px;
                min-width: 0;
                text-transform: none;
                color: var(--app-dark-primary-color, black);
                text-decoration: none;
            }
        </style>
        <firebase-app api-key="AIzaSyBgbzlvi_V6GjSLGZkLSSxVtZEAKA4B9jY" app="{{firebaseApp}}" auth-domain="bodaluzos.firebaseapp.com"
            database-url="https://bodaluzos.firebaseio.com" storage-bucket="bodaluzos.appspot.com" messaging-sender-id="24072448421">
        </firebase-app>
        <firebase-auth id="auth" user="{{user}}" provider="facebook" on-error="handleError" signed-in="{{logged}}"></firebase-auth>
        <paper-card heading="" image="" elevation="1" animated-shadow="false" hidden="[[logged]]">
            <div class="card-content">
                <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit. Ab eligendi suscipit nisi, porro rem aliquam. Vitae
                    sit, impedit quaerat doloremque veniam praesentium, dolores quam nulla, numquam quis itaque dolor magni?</p>
            </div>
            <div class="card-actions">

                <paper-button on-tap="login" raised>Acceder con Facebook</paper-button>

            </div>
        </paper-card>
        <paper-card heading="Perfecto [[user.displayName]]! " image="" elevation="1" animated-shadow="false" hidden="[[!logged]]">
            <div class="card-content">
                <p>Ahora que te has logado con facebook puedes confirmar tu asistencia. Gracias a facebook contamos con algunos
                    datos tuyos, pero si quieres los puedes cambiar.</p>
                <p>Además, puedes dejarnos tu teléfono por si tuvieramos que ponernos en contacto contigo asegurarnos que tenemos el correcto,
                    pero sólo si quieres!</p>
                <paper-input id="name" label="Nombre y Apellidos" value="[[user.displayName]]" required auto-validate error-message="Necesitamos tu nombre!"></paper-input>
                <gold-email-input id="email" label="email" value="[[user.email]]" auto-validate error-message="Necesitamos tu correo!"></gold-email-input>
                <gold-phone-input id="phone" label="Teléfono" country-code="34" phone-number-pattern="XXX-XXX-XXX" auto-validate></gold-phone-input>
            </div>
            <div class="card-actions">

                <paper-button on-tap="confirm" raised>Confirmar Asistencia</paper-button>

            </div>
        </paper-card>

    </template>
    <script>
        Polymer({
            is: 'bodaluzos-confirm',
            login: function(){
                this.$.auth.signInWithPopup().then(function(result) {
                    // This gives you a Facebook Access Token. You can use it to access the Facebook API.
                    var token = result.credential.accessToken;
                    // The signed-in user info.
                    var user = result.user;
                    // ...
                    console.log("Access!!", token, user);
                }).catch(function(error) {
                    // Handle Errors here.
                    var errorCode = error.code;
                    var errorMessage = error.message;
                    // The email of the user's account used.
                    var email = error.email;
                    // The firebase.auth.AuthCredential type that was used.
                    var credential = error.credential;
                    // ...
                    console.log("Error!!", errorCode, errorMessage);
                });
            },
            confirm: function(){
                var now = new Date();
                var sNow = now.toString()
                this.firebaseApp.database().ref("/guests/" + this.user.uid).set({
                        nombreFacebook: this.user.displayName,
                        emailFacebook: this.user.email,
                        nombre: this.$.name.value,
                        email: this.$.email.value,
                        phone: this.$.phone.value,
                        confirmDate: sNow,
                    });
            }
        });
    </script>
</dom-module>